# Volume Mounting in Docker

Whenever we destroy a container all the data inside the container is lost. To persist data beyond the lifecycle of a container, Docker provides a feature called Volumes. Volumes are directories or files that exist outside of the container's filesystem and can be shared between containers.

## What are Volumes?

Volumes are the preferred mechanism for persisting data generated by and used by Docker containers. While bind mounts depend on the host machine's directory structure, volumes are completely managed by Docker.

Volumes offer advantages over bind mounts:
- Easier to back up or migrate
- Can be managed using Docker API
- Work on both Linux and Windows containers
- Safer to share among multiple containers
- Volume drivers allow remote storage

## Types of Mounts

Docker supports three main types of mounts:

1. **Volumes** - Stored in a part of the host filesystem managed by Docker
2. **Bind Mounts** - Mount a file or directory from the host into the container
3. **tmpfs Mounts** - Stored in the host's memory only

## Mounting a Volume

You can mount a volume when running a container using the `-v` or `--mount` flag.

```bash
docker run -it -v /host/path:/container/path my-node-app
```

This command mounts the directory `/host/path` from the host machine to `/container/path` inside the container.

- `/host/path`: The path on the host machine where the data will be stored.
- `/container/path`: The path inside the container where the volume will be mounted.

## Create and Manage Volumes

### Creating Named Volumes

You can create a named volume using the `docker volume create` command.

```bash
docker volume create my_volume
```

This command creates a new volume named `my_volume`.

### Mounting Named Volumes to Containers

You can then mount this volume to a container:

```bash
docker run -it -v my_volume:/container/path my-node-app
```

This command mounts the named volume `my_volume` to `/container/path` inside the container.

### Using Multiple Volumes

A container can have multiple volumes mounted:

```bash
docker run -it \
  -v my_volume1:/data \
  -v my_volume2:/logs \
  my-node-app
```

## Inspecting Volumes

### Getting Volume Details

You can inspect a volume to see its details using the `docker volume inspect` command.

```bash
docker volume inspect my_volume
```

This command displays detailed information about the `my_volume`, including its mount point on the host machine. You'll see information like:
- Driver
- Labels
- Mountpoint
- Name
- Options

### Listing Volumes

You can list all the volumes on your Docker host using the `docker volume ls` command.

```bash
docker volume ls
```

This command lists all the volumes available on the Docker host.

### Finding Dangling Volumes

Dangling volumes are volumes not used by any container:

```bash
docker volume ls --filter dangling=true
```

## Removing Volumes

You can remove a volume using the `docker volume rm` command.

```bash
docker volume rm my_volume
```

This command removes the volume named `my_volume`. Note that you cannot remove a volume that is currently in use by a container.

### Removing Multiple Volumes

```bash
docker volume rm volume1 volume2 volume3
```

### Removing All Unused Volumes

```bash
docker volume prune
```

This removes all dangling volumes (not used by any container).

## Volume Types Comparison

| Feature | Named Volumes | Bind Mounts | tmpfs |
|---------|---------------|------------|-------|
| Location | Docker managed | Host machine | Memory |
| Persistence | Survives container deletion | Survives container deletion | Lost on container stop |
| Performance | Good | Best | Excellent |
| Use Case | Production data | Development | Cache, temp data |

## Best Practices for Volume Management

### 1. Use Named Volumes for Production
- More portable than bind mounts
- Easier to back up and migrate
- Docker manages the location

### 2. Use Bind Mounts for Development
- Easier to edit files while developing
- Direct access to source code
- Hot reload capability

### 3. Back Up Important Volumes
```bash
# Back up a volume
docker run --rm -v my_volume:/data -v $(pwd):/backup \
  ubuntu tar czf /backup/volume_backup.tar.gz -C /data .
```

### 4. Document Volume Usage
- Document what data each volume stores
- Document backup procedures
- Document recovery procedures

### 5. Regular Maintenance
```bash
# Remove dangling volumes
docker volume prune

# List volumes not in use
docker volume ls --filter dangling=true
```

## Volume Security Considerations

- Volumes contain sensitive data - secure appropriately
- Back up critical data regularly
- Consider encryption for sensitive information
- Restrict volume access to authorized containers

## Advanced Volume Scenarios

### Scenario 1: Database with Persistent Storage
```bash
docker run -d \
  --name postgres \
  -v postgres_data:/var/lib/postgresql/data \
  -e POSTGRES_PASSWORD=secret \
  postgres:15
```

### Scenario 2: Development Environment
```bash
docker run -it \
  --name dev_app \
  -v $(pwd):/app \
  -v /app/node_modules \
  node:18 \
  bash
```

### Scenario 3: Multi-Container Data Sharing
```bash
# Create volume
docker volume create shared_data

# Container 1 writes data
docker run -v shared_data:/data ubuntu touch /data/file.txt

# Container 2 reads data
docker run -v shared_data:/data ubuntu cat /data/file.txt
```

## Conclusion

Volumes are a powerful feature in Docker that allows you to persist data beyond the lifecycle of a container. By mounting volumes, you can share data between containers and ensure that important data is not lost when containers are destroyed. Understanding volumes is critical for building reliable, stateful applications with Docker.

## Next Steps

Explore [Advanced Dockerfile Techniques](advanced-dockerfile.md) to create more efficient images and learn about multi-stage builds.
